<!--
 * @Description: 
 * @Version: 1.0
 * @Author: dmjcb
 * @Email:  
 * @Date: 2022-10-26 19:53:02
 * @LastEditors: dmjcb
 * @LastEditTime: 2023-04-19 11:58:57
-->

# 右值引用

## 左值和右值

在 C++ 或者 C 语言中, 一个表达式(可以是字面量、变量、对象、函数的返回值等) 根据其使用场景不同, 分为左值表达式和右值表达式

- 左值

lvalue 指 loactor value, 可意为存储在内存中、有明确存储地址(`可寻址`)的数据

- 右值

rvalue 指 read value, 指的是那些可以提供数据值的数据(不一定可以寻址, 例如存储于寄存器中的数据)

## 判断

判断某个表达式是左值还是右值的方法包括,

### 赋值判断

可位于赋值运算符( = )左侧的表达式是左值

只能位于赋值运算符右侧的表达式是右值

```c
int a = 5;

// 错误, 5 不能为左值
5 = a;
```

其中, 变量 a 就是一个左值, 而字面量 5 就是一个右值

C++ 中的左值也可以当做右值使用

```c
// b 是一个左值
int b = 10;

// a、b 都是左值, 只不过将 b 可以当做右值使用
a = b;
```

### 名称判断

有名称的、可以获取到存储地址的表达式即为左值, 反之则是右值

以上面定义的变量 a、b 为例,

a 和 b 是变量名, 且通过 &a 和 &b 可以获得他们的存储地址, 因此 a 和 b 都是左值

字面量 5、10, 它们既没有名称, 也无法获取其存储地址(字面量通常存储在寄存器中, 或者和代码存储在一起),因此 5、10 都是右值

以上 2 种判定方法只适用于大部分场景

## 右值引用

右值引用可以从字面意思上理解, 指的是以`引用传递`(而非值传递)的方式使用 C++ 右值

C++98/03 标准中就有引用, 使用 "&" 表示

但此种引用方式在正常情况下只能操作 C++ 中的左值, 无法对右值添加引用

```c++
int num = 10;

// 正确
int &b = num;

// 错误
int &c = 10;
```

编译器允许为 num 左值建立一个引用, 但不可以为 10 这个右值建立引用

因此, C++98/03 标准中的引用又称为**左值引用**

虽然 C++98/03 标准不支持为右值建立非常量左值引用, 但允许使用常量左值引用操作右值

常量左值引用既可以操作左值, 也可以操作右值

```c
int num = 10;

const int &b = num;

const int &c = 10;
```

右值往往是没有名称的, 因此要使用它只能借助引用的方式这就产生一个问题, 实际开发中可能需要对右值进行修改(实现移动语义时就需要), 显然左值引用的方式是行不通的

## 定义

C++11 新标准引入右值引用, 用 `&&` 表示

和声明左值引用一样, 右值引用也必须立即进行初始化操作, 且只能使用右值进行初始化

```c++
int num = 10;

const int &b = num;

const int &c = 10;
```

和常量左值引用不同的是, 右值引用还可以对右值进行修改

```c++
int num = 10;

// 错误, 右值引用不能初始化为左值

int && a = num;

// 右值引用
int && a = 10;
```

左值引用和右值引用各自可以引用左值还是右值表

| 引用类型       | 可以引用的值类型 | 使用场景   |          |     |
| -------------- | ---------------- | ---------- | -------- | --- |
| 非常量左值     | 常量左值         | 非常量右值 | 常量右值 |     |                          |
| 非常量左值引用 | Y                | N          | N        | N   | 无                       |
| 常量左值引用   | Y                | Y          | Y        | Y   | 常用类中构建拷贝构造函数 |
| 非常量右值引用 | N                | N          | Y        | N   | 移动语义、完美转发       |
| 常量右值引用   | N                | N          | Y        | Y   | 无实际用途               |