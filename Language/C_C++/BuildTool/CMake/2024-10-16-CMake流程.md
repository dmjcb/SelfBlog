---
title: "C_C++-构建-CMake流程"
date: 2023-09-16
categories: [C_C++]
tags: [C_C++]
excerpt: "CMake指令"
---

> - [CMAKE手册](https://www.zybuluo.com/khan-lau/note/254724)
> - [用CMake构建工程时 cmake -G "Unix Makefiles" 的使用](https://blog.csdn.net/yangjia_cheng/article/details/111408753)
> - [卸载 make install 编译安装的软件](https://blog.csdn.net/reasonyuanrobot/article/details/106732047)
> - [CMake install 命令】精通CMake安装：灵活、高效的构建和部署](https://developer.aliyun.com/article/1468544)
> - [CSDN【CMake】cmake的install指令](https://blog.csdn.net/qq_38410730/article/details/102837401)

# CMake流程

CMake是C_C++构建文件生成工具, 用于生成项目构建文件

```mermaid
graph LR
    S(开始)
    S --> A[编写]
        A --> A1[/CMakeLists.txt/]
    A1 --> B[生成构建文件]
        B --> B1[/Makefile/]
    B1 --> C[构建]
        C --> C1[/可执行程序/库/]
    C1 --> D[安装]
    D --> F(结束)
```

Main.cpp

```c
#include <iostream>
 
int main() {
    std::cout << "Hello World" << std::endl;
    return 0;
}
```

## 编写

编写CMakeList.txt

```cmake
# 设置CMake的最低版本要求
cmake_minimum_required(VERSION 3.10)

# 设置项目名称
project(Main)

# 设置C++标准(C++11)
set(CMAKE_CXX_STANDARD 11) 

# 定义可执行文件
add_executable(Main Main.cpp)
```

## 生成构建文件

CMake 读取并解析 CMakeLists.txt, 检查系统环境、依赖库、编译器设置等, 将变量(如 `CMAKE_CXX_STANDARD`、`CMAKE_BUILD_TYPE`)等赋值, 生成对应平台构建文件, 例如在 Unix 系统上会生成 Makefile

### 指令

- 使用当前目录CMakeList.txt, 当目录生成构建文件

```sh
cmake .
```

![](/Resource/Imgur/20241027_184942.jpg)

此时会在当前目录下产生大量中间文件, 故不推荐此种用法

- 使用当前目录CMakeList.txt, 在Build目录生成构建文件

```sh
cmake -B Build
```

![](/Resource/Imgur/20241027_202125.jpg)

- 指定Source目录下CMakeList.txt, 在Build目录生成构建文件

```sh
cmake -S Source -B Build
```

## 构建

该阶段构建文件将被构建工具(如make)调用, 开始实际编译和链接

### 指令

- 当前目录构建

```sh
cmake --build .
```

- 在Build目录下构建

```sh
cmake --build Build
```

![](/Resource/Imgur/20241027_202211.jpg)

### 构建类型

#### 编译源文件

构建系统会调用指定编译器(如 g++ 或 clang++)来编译项目中源代码文件(如 .cpp 文件)

CMake 会自动处理依赖关系, 若某个源文件未修改, 则不会重新编译

#### 链接生成目标文件

编译器会将编译好的目标文件链接成最终可执行文件或库文件(动态库或静态库)

链接器会根据 CMake 配置将依赖库文件正确地链接到目标文件中

#### 输出可执行文件或库

最终可执行文件或库文件会出现在 CMake 配置输出目录(通常是 Build/ 目录)中

## 安装

### 指令

- 在Build目录下安装

```sh
cmake --install Build
```