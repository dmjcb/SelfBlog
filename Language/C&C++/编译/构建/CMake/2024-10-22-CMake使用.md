---
title: "C/C++-构建-CMake-使用"
date: 2023-09-16
categories: [C&C++]
tags: [C&C++]
excerpt: "CMake使用"
---

> [cmake使用详细教程（日常使用这一篇就足够了）](https://blog.csdn.net/iuu77/article/details/129229361)

# CMake使用

## 单文件

```c
// Main.cpp
#include <iostream>
 
int main() {
    std::cout << "Hello World" << std::endl;
    return 0;
}
```

```py
# CMakeLists.txt
cmake_minimum_required(VERSION 3.30)
 
project(Main)
 
add_executable(Main Main.cpp)
```

生成

```sh
mkdir Build

cmake -B Build

cmake --build Build
```

![](https://raw.githubusercontent.com/dmjcb/SelfImgur/main/20241022204809.png)

![](https://raw.githubusercontent.com/dmjcb/SelfImgur/main/20241022205030.png)

## 同目录多文件

```py
# CMakeLists.txt
cmake_minimum_required(VERSION 3.30)
 
project(Main)

# 将当前目录所有文件添加到变量SRC_LIST
aux_source_directory(. SRC_LIST)
 
add_executable(Main ${SRC_LIST})
```

## 多目录多文件

![](https://raw.githubusercontent.com/dmjcb/SelfImgur/main/20241022205947.png)

```c++
// Include_1/TestFunc_1.h
#include <iostream>
void Hello_1();

// Include_2/TestFunc_2.h
#include <iostream>
void Hello_2();

// Source_1/TestFunc_1.cpp
#include "TestFunc_1.h"
void Hello_1() {
    std::cout << "Hello_1" << std::endl;
}

// Source_2/TestFunc_2.cpp
#include "TestFunc_2.h"
void Hello_12() {
    std::cout << "Hello_2" << std::endl;
}

// Main.cpp
#include "TestFunc_1.h"
#include "TestFunc_2.h"

int main() {
    Hello_1();
    Hello_2();

    return 0;
}
```

```py
# CMakeLists.txt
cmake_minimum_required(VERSION 3.16)
 
project(Main)

# 自动去指定目录下寻找头文件, 相当于gcc -I
include_directories(./Include_1 ./Include_2)

# 将Source_1目录里所有源文件路径存储与SRC_LIST1
aux_source_directory(Source_1 SRC_LIST1)
aux_source_directory(Source_2 SRC_LIST2)

add_executable(Main ${SRC_LIST1} ${SRC_LIST2} Main.cpp)
```

![](https://raw.githubusercontent.com/dmjcb/SelfImgur/main/20241022210549.png)

## 生成库文件

![](https://raw.githubusercontent.com/dmjcb/SelfImgur/main/20241022214837.png)

```c++
// Include/API.hpp
#ifndef __INCLUDE_API_HPP__
#define __INCLUDE_API_HPP__

#include <iostream>

#ifdef _WIN32
    #define API_EXPORT __declspec(dllexport)
    #define API_IMPORT __declspec(dllimport)
#else
    #define API_EXPORT __attribute__((visibility("default")))
    #define API_IMPORT
#endif

#ifdef __cplusplus
extern "C" {
#endif

void Display();

int Add(int x, int y);

#ifdef __cplusplus
}
#endif

#endif

// Source/API.cpp
#include "API.hpp"
void Display() {
    std::cout << "Print API success!" << std::endl;
}

int Add(int x, int y) {
    return x + y;
}
```

```py
# CMakeLists.txt
cmake_minimum_required(VERSION 3.16)
 
project(APILib)

include_directories(${PROJECT_SOURCE_DIR}/Include)

aux_source_directory(${PROJECT_SOURCE_DIR}/Source SRC_LIST)

add_library(APIShared SHARED ${SRC_LIST})
add_library(APIStatic STATIC ${SRC_LIST})

set_target_properties(APIShared PROPERTIES OUTPUT_NAME "LibAPI")
set_target_properties(APIStatic PROPERTIES OUTPUT_NAME "LibAPI")

set(LIBRARY_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/Library)
```

![](https://raw.githubusercontent.com/dmjcb/SelfImgur/main/20241022215102.png)

![](https://raw.githubusercontent.com/dmjcb/SelfImgur/main/20241022215308.png)

## 链接库

![](https://raw.githubusercontent.com/dmjcb/SelfImgur/main/20241022223614.png)

```py
# CMakeLists.txt
cmake_minimum_required(VERSION 3.16)
 
project(APILib)

include_directories(${PROJECT_SOURCE_DIR}/Include)

# 将从Library目录中寻找的APITest库路径与名称值存储于FUNC_LIB
find_library(FUNC_LIB APITest ${PROJECT_SOURCE_DIR}/Library)

# 设置可执行文件生成目录
set(EXECUTABLE_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/Bin)

add_executable(Main Main.cpp)

target_link_libraries(Main ${FUNC_LIB})
```

```c
// Main.cpp
#include "API.hpp"

int main(void) {
    int res = Add(1, 2);
    std::cout << "res = " << res << std::endl;

    Display();

    return 0;
}
```

![](https://raw.githubusercontent.com/dmjcb/SelfImgur/main/20241022223715.png)

## 多CMakeLists.txt

![](https://raw.githubusercontent.com/dmjcb/SelfImgur/main/20241022231149.png)

Hello/CMakeLists.txt

```py
cmake_minimum_required(VERSION 3.16)
 
project(Hello)

include_directories(${PROJECT_SOURCE_DIR}/Include)

aux_source_directory(${PROJECT_SOURCE_DIR}/Source SRC_LIST)

set(LIBRARY_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/../Library)

add_library(Hello SHARED ${SRC_LIST})
```

CMakeLists.txt

```py
# CMakeLists.txt
cmake_minimum_required(VERSION 3.16)
 
project(Main)

include_directories(${PROJECT_SOURCE_DIR}/Hello/Include)

set(EXECUTABLE_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/Bin)

add_executable(${PROJECT_NAME} Main.cpp)

target_link_libraries(${PROJECT_NAME} Hello)

add_subdirectory(Hello)
```

![](https://raw.githubusercontent.com/dmjcb/SelfImgur/main/20241022231348.png)