---
title: "Django视图与路由"
date: 2021-01-16
categories: [Python]
tags: [Python]
excerpt: "Django视图与路由"
render_with_liquid: false
---

# Django 视图路由

访问网站本质即为访问对应 html 文件, 后再由浏览器等对其进行渲染, 最终展示出页面

## 视图

创建项目TestDjango并创建App应用

### 静态读取

- 创建目录

在 App 目录下新建 templates 文件夹

![](/Resource/Imgur/20241026_122356.jpg)

注册模板目录, 新建的模板目录需在项目设置文件中进行注册

打开主目录 settings.py文件, 找到 TEMPLATES, 将新增模板的路径添加至'DIRS'项中:

```diff
TEMPLATES = [
    {
        ...
        'DIRS': [
            os.path.join(BASE_DIR, 'templates'), 

+           os.path.join(BASE_DIR, 'App/templates')
        ], 
        ...
    }, 
]
```

![](/Resource/Imgur/20241026_122517.jpg)

- 创建静态文件

在 App/templates 目录下新建 index.html

```html
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Title</title>
    </head>
    <body>
        <h1>Hello World!</h1>
    </body>
</html>
```

- 编写视图函数

App/views.py 文件

```py
from django.shortcuts import render

# Create your views here.

def index(request):
    return render(request, 'index.html')
```

- 绑定子路由

编写好函数后, 需将其绑定到对应路由, 由于此处是在项目中应用里配置, 故为子路由

在 App 目录下新建 urls.py 文件

```py
from django.urls import path
from App import views

urlpatterns = [
    # 将函数绑定至对应路由
    path('index/', views.index)
]
```

- 注册子路由

绑定本应用路由后, 还需在项目中进行注册

主目录urls.py文件添加

```diff
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    ...
    # 注册app应用的路由
+   path('App/', include('App.urls'))
    ...
]
```

此处 include()函数含义为包含 App 中所有路由, 即实现从主路由分发至子路由(路由转发)

运行, 访问http://127.0.0.1:8000/App/index

```sh
python manage.py runserver 8080
```

![](/Resource/Imgur/20241026_122955.jpg)

![](/Resource/Imgur/20241026_123312.jpg)

### 读取数据

访问http://127.0.0.1:8000/App/db, 在网页上显示数据库中所有元素信息

在 App/templates 目录下新建 db.html

```html
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Title</title>
    </head>
    <body>
        {% for i in data %}
        <h1>学号 : {{ i.num }}</h1>
        <h2>姓名 : {{ i.name }}</h2>
        <h2>年龄 : {{ i.age }}</h2>
        {% if i.sex == 'M' %}
        <h2>性别 : 男</h2>
        {% elif i.sex == 'W' %}
        <h2>性别 : 男</h2>
        {% endif %} {% endfor %}
    </body>
</html>
```

此处 data 为数据库中值, 读取 html 作为参数传入

- 编写视图函数

编辑 App/views.py, 增加

```py
...

def get_db(request):
    # 获取数据中全部信息
    stu_list = [i for i in Stu.objects.all()]

    return render(request, 'db.html', {'data' : stu_list})
```

- 添加路由

编辑 app/urls.py, 增加

```py
urlpatterns = [
    ...

    path('get_db/', views.db)
]
```

运行项目, 访问http://127.0.0.1:8000/App/get_db

## 动态路由

### 关键字实现

#### 单关键字

App/views.py

```py
from django.http import HttpResponse
from django.shortcuts import render

# Create your views here.
def index(request, value):
    return HttpResponse("URL value = " + value)
```

App/urls.py

```py
from django.urls import path, re_path
from App import views

urlpatterns = [
    # 将函数绑定至对应路由
    re_path(r'^index/(\w+)$', views.index)
]
```

项目urls.py

```py
from django.contrib import admin
from django.urls import path, include

import App.views

urlpatterns = [
    path('admin/', admin.site.urls),
    # 注册app应用路由
    path('App/', include('App.urls'))
]
```

| 参数 | 含义                                     |
| ---- | --------------------------------------- |
| `\w` | 匹配字母、数字、下划线, 等价于[A-Za-z0-9_] |
| `+`  | 匹配前面的子表达式一次或多次               |
| `$`  | 表示结尾                                 |

此时可匹配127.0.0.1:8080/index/<字符>, 并且<字符>部分值将作为 index 函数第二个参数

![](/Resource/Imgur/20241026_124322.jpg)

![](/Resource/Imgur/20241026_124348.jpg)

#### 多关键字

App/views.py

```py
from django.http import HttpResponse

def value(request, v1, v2):
    res = "v1:%s v2:%s"%(v1, v2)
    return HttpResponse(res)
```

App/urls.py

```py
from django.urls import path, re_path
from App import views

urlpatterns = [
    re_path(r'^value/(?P<v1>\w+)/(?P<v2>\w+)', views.value), 
]
```

前面 w+传给 v1, 后面 w+传给 v2, 此时可匹配`127.0.0.1:8000/value/<字符1>/<字符2>`这类 url, 并且字符1将传给 value 函数v1参数, 字符2将传给value函数v2参数

### 反射实现

反射, 通过输入函数名调用函数

App/urls.py

```py
from django.urls import path, re_path
from App import views

urlpatterns = [
    re_path(r'^func/(?P<fuc_name>\w+)/$', views.use_fuc_byname), 
]
```

App/views.py


```py
from django.http import HttpResponse

def use_fuc_byname(request, fuc_name):
    return eval(fuc_name)(request)

def hello_world(request):
    return HttpResponse('HELLO WORLD')

def goodbye_world(request):
    return HttpResponse('GOODBYE WORLD')
```

访问`http:127.0.0.1:8000/func/hello_world`, 会自动调用 hello_world()

![](/Resource/Imgur/20241026_124808.jpg)

#### 删除硬编码URL

硬编码即href里的"/polls/"部分

```html
<li><a href="/polls/{{ question.id }}/">{{ question.question_text }}</a></li>
```

它对于代码修改非常不利, 前面给urls定义了一个name别名, 可以用它来解决这个问题, 具体代码如下:

```html
<li><a href="{% url 'detail' question.id %}">{{ question.question_text }}</a></li>
```

Django会在polls.urls文件中查找name='detail'的路由, 具体的就是下面这行:

```py
path('<int:question_id>/', views.detail, name='detail'), 
```

若想将polls的detail视图的URL更换为polls/specifics/12/, 那么仅仅只需要在polls/urls.py文件中, 将对应的正则表达式改成下面这样的就行, 所有模板中对它的引用都会自动修改成新的链接

```py
# 添加新的单词'specifics'
path('specifics/<int:question_id>/', views.detail, name='detail'), 
```
