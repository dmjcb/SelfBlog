---
title: "Python-Flask-操作"
date: 2021-09-24
categories: [Python]
tags: [Python]
excerpt: "Flask命令"
---

> - [Python-web Flask框架项目打包成exe文件](https://www.cxyzjd.com/article/qq_42370335/114276385)  
> - [Flask项目能打包为单个exe文件运行？掌握原理后居然如此简单!](https://bbs.huaweicloud.com/blogs/210229)

# Flask操作

## 安装

```sh
pip install flask
```

## 运行

创建app.py文件

```py
from flask import Flask

app = Flask(__name__)

@app.route('/')
def hello():
    return 'Hello, World!'

if __name__ == '__main__':
    app.run(debug=True)
```

![](/Resource/Imgur/20241026_130837.jpg)

![](/Resource/Imgur/20241026_130909.jpg)

```sh
flask run
```

- 指定地址端口
  
```py
flask run --host=0.0.0.0 --port=5000
```

- 终止进程

```sh
ps -aux | grep flask | grep -v grep | awk {'print $2'} | xargs kill -9
```

## 部署

### Docker单例

```docker
from python:3.7-alpine

workdir /app

expose 5000

copy . .

run pip install -i https://pypi.tuna.tsinghua.edu.cn/simple/ Flask

cmd flask run --host=0.0.0.0 --port=5000
```

![](/Resource/Imgur/20241027_215342.jpg)

### supervisor

- supervisor.conf

```ini
[supervisord]
nodaemon=true

[program:app]
directory=/home/dmjcb/Test
command=flask run --host=0.0.0.0 --port=5000
user=dmjcb
autostart=true
autorestart=true
```

```
supervisord -c supervisor.conf
```

![](/Resource/Imgur/20241027_220224.jpg)

![](/Resource/Imgur/20241027_220249.jpg)

### uwsgi

- uwsgi.ini

```ini
[uwsgi]
# 启动主进程, 来管理其他进程
master = true

# 地址和端口号
http = :5000

# app.py路径
wsgi-file = app.py

# uwsgi指定的是application, 而flask中是app
callable = app

# 开启的进程数量
processes = 2

# 运行线程
threads = 8

# 设置用于uwsgi包解析的内部缓存区大小为64k.默认是4k
buffer-size = 32768
```

```sh
uwsgi uwsgi.ini
```

## 打包

### 方法一

```sh
pyinstaller -F -i --add-data="./static;./static" --add-data="./templates;./templates"  app.py
```

dist 目录下会生成可执行文件

### 方法二

```sh
pip install pyinstaller -i https://pypi.doubanio.com/simple
```

- 打包

```sh
pyinstaller -F app.py
```

- 复制文件

将static 与templates 目录复制到dist目录下

- 修改.spec

```sh
datas=[('./static', 'static'), ('./templates', 'templates')], 
```

```sh
pyinstaller -F *.spec
```

## 问题

### 跨域

前端使用 XMLHttpRequest 发送 GET 请求时, 后端 Flask已收到请求, 但前端无法显示返回值

- 前端
  
```html
<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8" />
    <script>
        function loadXMLDoc() {
            var xmlhttp
            if (window.XMLHttpRequest) {
                // IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码
                xmlhttp = new XMLHttpRequest()
            } else {
                // IE6, IE5 浏览器执行代码
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP")
            }
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    const v = xmlhttp.responseText
                    alert(v)
                }
            }
            xmlhttp.open("GET", "http://127.0.0.1:5000/", true)
            xmlhttp.send()
        }
    </script>
    </head>

    <body>
        <button type="button" onclick="loadXMLDoc()">获取内容</button>
    </body>
</html>
```

- 后端

```py
from flask import Flask

app = Flask(__name__)

@app.route('/', methods=['GET', 'POST'])
def hello_world():
    return 'HELLO'

if __name__ == '__main__':
    app.run()
```

### 分析

使用 F12 进入控制台后发现如下错误

![](/Resource/Imgur/20200722234713.png)

通过查询此为跨域问题, 所以需设置Flask允许跨域

### 解决

Flask 配 Cors 跨域, 使用 flask-cors 包, 并有两种方式

| 方式                 | 范围              | 特点                      |
| -------------------- | ----------------- | ------------------------- |
| @cross_origin 装饰器 | 单个路由          | 适用于配置特定的 API 接口 |
| CORS 函数            | 配置全局 API 接口 | 适用于全局的 API 接口配置 |

```sh
pip install flask-cors
```

```py
# 后端代码修改为
from flask import Flask
from flask_cors import cross_origin

app = Flask(__name__)

@app.route('/', methods=['GET', 'POST'])
@cross_origin()
def hello_world():
    return 'HELLO'

if __name__ == '__main__':
    app.run()
```

![](/Resource/Imgur/20200722235455.png)