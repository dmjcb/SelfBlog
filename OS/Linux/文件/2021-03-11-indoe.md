---
title: "Linux-概念-inode"
date: 2021-03-11
categories: [操作系统]
tags: [Linux]
excerpt: "inode"
---

# inode

扇区($sector$)是硬盘最小存储单位, 每个扇区储存$512$字节(0.5KB), 操作系统读取硬盘时为提高效率会一次连续读取多个扇区

块($block$)由多个扇区组成, 是文件存取最小单位, 大小常见为$4KB$, 即连续八个扇区组成

## 定义

文件数据与文件创建者, 文件创建日期, 文件大小等文件元信息都储存在块中

储存文件元信息区域就是$inode$(索引节点)

```mermaid
graph LR;
    n(inode内容)

    n-->a0(文件的字节数)
    n-->a1(文件拥有者User ID)
    n-->a2(文件 Group ID)
    n-->a3(文件的读、写、执行权限)
    n-->a4(文件的时间戳)
        a4-->a41(ctime : inode上一次变动时间)
        a4-->a42(mtime : 文件内容上一次变动时间)
        a4-->a43(atime : 文件上一次打开的时间)
    n-->a5(链接数, 即有多少文件名指向该inode)
    n-->a6(文件数据block位置)
```

## inode区

硬盘格式化时候OS自动将硬盘分为,

- 数据区, 存放文件数据

- $inode$区($inode$ $table$), 存放inode所包含信息

每个$inode$节点大小一般是128字节或256字节, 硬盘格式化时就会给定$inode$节点总数, 一般是每1KB或2KB设置一个$inode$

如1GB硬盘中, 每个$inode$节点大小为128字节, 每1KB就设置一个$inode$, 那么$inode$ $table$大小为128MB, 占硬盘空间12.8\%

## 作用

- 删除文件

当文件名包含特殊字符无法正常删除时, 可直接删除inode节点, 即可删除文件

- 移动/重命名文件

只会改变文件名, 不影响inode号码

- 文件操作

打开文件后, 系统就以inode号码来识别它, 而不再考虑文件名

更新文件时, 新版文件以同样文件名, 生成一个新inode, 不会影响到运行中文件, 

下次运行软件时, 文件名就自动指向新版文件, 旧版文件inode则被回收

## 命令

### 信息

- 查看分区inode信息
  
```sh
df -i
```

```sh
dmjcb@Casper:~$ df -i
文件系统         Inodes 已用(I)  可用(I) 已用(I)% 挂载点
udev            3539123     612  3538511       1% /dev
tmpfs           3550905    1273  3549632       1% /run
/dev/nvme0n1p2 62480384  327472 62152912       1% /
tmpfs           3550905       1  3550904       1% /dev/shm
tmpfs           3550905       5  3550900       1% /run/lock
tmpfs           3550905      19  3550886       1% /sys/fs/cgroup
/dev/loop0           29      29        0     100% /snap/bare/5
/dev/loop2        76208   76208        0     100% /snap/gtk-common-themes/1535
/dev/loop4         1939    1939        0     100% /snap/snap-store/1113
/dev/loop6          651     651        0     100% /snap/snapd/21759
/dev/loop10       18272   18272        0     100% /snap/gnome-3-38-2004/119
/dev/loop7        20797   20797        0     100% /snap/gnome-42-2204/176
/dev/loop8          496     496        0     100% /snap/snapd/18357
/dev/loop9        12049   12049        0     100% /snap/core20/2379
/dev/loop11       18307   18307        0     100% /snap/gnome-3-38-2004/143
/dev/nvme0n1p1        0       0        0        - /boot/efi
tmpfs           3550905      37  3550868       1% /run/user/126
/dev/loop13        1934    1934        0     100% /snap/snap-store/1216
/dev/loop5        14460   14460        0     100% /snap/core22/1621
/dev/loop3        11851   11851        0     100% /snap/core20/2434
/dev/loop1        14246   14246        0     100% /snap/core22/1663
tmpfs           3550905     103  3550802       1% /run/user/1000
```

- 查看文件inode信息
  
```sh
stat [文件]
```

```sh
dmjcb@Casper:~$ stat InitProxy.sh
  文件：InitProxy.sh
  大小：545             块：8          IO 块：4096   普通文件
设备：10302h/66306d     Inode：18219400    硬链接：1
权限：(0755/-rwxr-xr-x)  Uid：(    0/    root)   Gid：(    0/    root)
最近访问：2024-10-30 18:53:29.829058975 +0500
最近更改：2024-10-15 16:58:37.131683067 +0500
最近改动：2024-10-15 16:58:37.131683067 +0500
创建时间：-
```

- 查看文件inode号码
  
```sh
ls -il
```

```sh
dmjcb@Casper:~$ ls -il
总用量 64
18219052 drwxr-xr-x  2 dmjcb dmjcb 4096 Қыр  1 21:59 公共的
18219051 drwxr-xr-x  2 dmjcb dmjcb 4096 Қыр  1 21:59 模板
18219056 drwxr-xr-x  2 dmjcb dmjcb 4096 Қыр  1 21:59 视频
18219055 drwxr-xr-x  2 dmjcb dmjcb 4096 Қыр  1 21:59 图片
18219053 drwxr-xr-x  2 dmjcb dmjcb 4096 Қыр 23 12:52 文档
18219050 drwxr-xr-x  2 dmjcb dmjcb 4096 Қыр  6 18:37 下载
18219054 drwxr-xr-x  2 dmjcb dmjcb 4096 Қыр  1 21:59 音乐
18219049 drwxr-xr-x  2 dmjcb dmjcb 4096 Қыр  1 21:59 桌面
18221681 drwxrwxr-x  7 dmjcb dmjcb 4096 Қаз 30 17:15 CMakeTest
18220812 drwxrwxr-x  5 dmjcb dmjcb 4096 Қаз 30 18:14 Code
18220258 drwxrwxr-x 13 dmjcb dmjcb 4096 Қаз 30 20:27 dmjcb.github.io
18350257 drwxrwxr-x  3 dmjcb dmjcb 4096 Қаз 27 11:05 DockerTest
18230649 drwxrwxr-x  3 dmjcb dmjcb 4096 Қаз 31 19:52 GitTest
18219400 -rwxr-xr-x  1 root  root   545 Қаз 15 16:58 InitProxy.sh
18220111 drwx------  3 dmjcb dmjcb 4096 Қыр  6 19:16 snap
18219336 drwxrwxr-t  2 dmjcb dmjcb 4096 Қыр  1 22:13 thinclient_drives
```

### inode号码

- 硬链接

```sh
ln [源文件] [链接文件]
```

inode号码与源文件相同, 例如下面a.txt 与 a

```sh
dmjcb@Casper:~$ ls -la
总用量 248
drwxr-xr-x 30 dmjcb dmjcb  4096 Қар  1 17:12 .
drwxr-xr-x  4 root  root   4096 Қыр 23 12:52 ..
drwxr-xr-x  2 dmjcb dmjcb  4096 Қыр  1 21:59 公共的
drwxr-xr-x  2 dmjcb dmjcb  4096 Қыр  1 21:59 模板
drwxr-xr-x  2 dmjcb dmjcb  4096 Қыр  1 21:59 视频
drwxr-xr-x  2 dmjcb dmjcb  4096 Қыр  1 21:59 图片
drwxr-xr-x  2 dmjcb dmjcb  4096 Қыр 23 12:52 文档
drwxr-xr-x  2 dmjcb dmjcb  4096 Қыр  6 18:37 下载
drwxr-xr-x  2 dmjcb dmjcb  4096 Қыр  1 21:59 音乐
drwxr-xr-x  2 dmjcb dmjcb  4096 Қыр  1 21:59 桌面
-rw-rw-r--  2 dmjcb dmjcb     0 Қар  1 17:11 a
drwxrwxr-x  4 dmjcb dmjcb  4096 Қаз 26 22:45 .ansible
-rw-rw-r--  2 dmjcb dmjcb     0 Қар  1 17:11 a.txt
```

- 软链接

```sh
ln -s [源文件] [链接文件]
```

inode号码不同, 但是inode号码指向源文件名, 例如下面a.txt 与 a

```sh
dmjcb@Casper:~$ ls -la
总用量 248
drwxr-xr-x 30 dmjcb dmjcb  4096 Қар  1 17:13 .
drwxr-xr-x  4 root  root   4096 Қыр 23 12:52 ..
drwxr-xr-x  2 dmjcb dmjcb  4096 Қыр  1 21:59 公共的
drwxr-xr-x  2 dmjcb dmjcb  4096 Қыр  1 21:59 模板
drwxr-xr-x  2 dmjcb dmjcb  4096 Қыр  1 21:59 视频
drwxr-xr-x  2 dmjcb dmjcb  4096 Қыр  1 21:59 图片
drwxr-xr-x  2 dmjcb dmjcb  4096 Қыр 23 12:52 文档
drwxr-xr-x  2 dmjcb dmjcb  4096 Қыр  6 18:37 下载
drwxr-xr-x  2 dmjcb dmjcb  4096 Қыр  1 21:59 音乐
drwxr-xr-x  2 dmjcb dmjcb  4096 Қыр  1 21:59 桌面
lrwxrwxrwx  1 dmjcb dmjcb     5 Қар  1 17:13 a -> a.txt
drwxrwxr-x  4 dmjcb dmjcb  4096 Қаз 26 22:45 .ansible
-rw-rw-r--  1 dmjcb dmjcb     0 Қар  1 17:11 a.txt
```

### 删除

```sh
find [搜索路径] -inum [文件inode号码] -delete
```
